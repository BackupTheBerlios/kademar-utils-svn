#!/bin/bash
#Execució de programa, amb el seu associat
#Adonay Sanz - kademar 24 Abril 2006 - GNU/GPL 2
#Modificat 05-09-06 Adonay
#set -x #Debug
#Paràmetre = programa a executar
prog="$*"

#Directori de la ruta passada
directori=`dirname "$1"`

[ -z "$prog" ] && echo "Need a parameter" && exit 1

#Entres al directori en si
cd "$directori"

#El fem executable
chmod +x "$prog" 2>/dev/null


#Execució directa
"$prog" ; result=$?


#Si l'execució directa ha fallat, prova-ho amb el programa adequat
if [ $result != "0" ]; then
	#Agafa la seva terminació
	terminacio=${prog##*.}
	
	
	#Executa el programa que toca
	case "$terminacio" in
	
	#Binary
	[Bb][Ii][Nn])
	#El fem executable
	chmod +x "$prog"
	"$prog"
	;;
	
	#Bash/executable Programs  -  sh/run/bash/package
	[Ss][Hh]|[Rr][Uu][Nn]|[Bb][Aa][Ss][Hh]|[Pp][Aa][Cc][Kk][Aa][Gg][Ee]|[Pp][Kk][Gg])
	sh "$prog"
	;;
	
	#Csh Programs  -   csh
	[Cc][Ss][Hh])
	if [ -n "`whereis csh | sed s/csh://g`" ]; then
		csh "$prog"
	else
		. /etc/default/locale
		case "$LANG" in
		ca*)
		kdialog  --sorry "No tens el programa 'csh' encarregat d'executar $prog. Necessites tenir 'csh' per utilitzar-lo. \n Instal·la'l i torna-ho a provar."
		;;
		es*)
		kdialog  --sorry "No tienes el programa 'csh' encargado de ejecutar $prog. Necesitas tener 'csh' para usarlo. \n Instálalo y vuélvelo a intentar."
		;;
		en*|*)
		kdialog  --sorry "You don't have 'csh' program, wich executes $prog. You need 'csh' to use it. \n Install it and try it again."
		;;
		esac
	fi
	;;

	
	#Python  -  py/python/pyc
	[Pp][yY]|[Pp][Yy][Tt][Hh][Oo][Nn]|[Pp][Yy][Cc])
	python "$prog"
	;;

	#Perl  -  pl/perl
	[Pp][Ee][Rr][Ll]|[Pp][Ll])
	perl "$prog"
	;;

	#Windows  -  Exe
	[Ee][Xx][Ee])
	if [ -n "`whereis wine | sed s/wine://g`" ]; then
		wine "$prog"
	else
		. /etc/default/locale
		case "$LANG" in
		ca*)
		kdialog  --sorry "No tens el programa 'wine' encarregat d'executar $prog. Necessites tenir 'wine' per utilitzar-lo. \n Instal·la'l i torna-ho a provar."
		;;
		es*)
		kdialog  --sorry "No tienes el programa 'wine' encargado de ejecutar $prog. Necesitas tener 'wine' para usarlo. \n Instálalo y vuélvelo a intentar."
		;;
		en*|*)
		kdialog  --sorry "You don't have 'wine' program, wich executes $prog. You need 'wine' to use it. \n Install it and try it again."
		;;
		esac
	fi
	;;
	
	#All
	*)
	sh "$prog"
	;;
	
	esac
fi
